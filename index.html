<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Web app game gamification gi√∫p cai nghi·ªán th·ªß d√¢m th√¥ng qua thi·ªÅn ƒë·ªãnh v√† qu√°n t∆∞·ªüng 32 th·ªÉ tr∆∞·ª£c">
    <title>Qu√°n 32 Th·ªÉ Tr∆∞·ª£c - Game Thanh T·ªãnh</title>
    
    <!-- Three.js cho 3D -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <!-- Firebase -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        window.firebase = { initializeApp, getAuth, getFirestore };
    </script>
    
    <!-- CSS -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/game-ui.css">
    
    <!-- PWA -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1a1a2e">
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-content">
            <div class="voxel-loader"></div>
            <p>ƒêang t·∫£i th·∫ø gi·ªõi thanh t·ªãnh...</p>
        </div>
    </div>

        <!-- Auth Modal -->
        <div id="auth-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>ƒêƒÉng Nh·∫≠p / ƒêƒÉng K√Ω</h2>
            <div id="auth-tabs">
                <button class="tab-btn active" data-tab="login">ƒêƒÉng Nh·∫≠p</button>
                <button class="tab-btn" data-tab="signup">ƒêƒÉng K√Ω</button>
            </div>
            
            <div id="login-form" class="auth-form active">
                <input type="email" id="login-email" placeholder="Email" required>
                <input type="password" id="login-password" placeholder="M·∫≠t kh·∫©u" required>
                <button id="login-btn" class="btn-primary">ƒêƒÉng Nh·∫≠p</button>
                <button id="google-login-btn" class="btn-google">ƒêƒÉng nh·∫≠p v·ªõi Google</button>
                <p id="login-error" class="error-message"></p>
            </div>
            
            <div id="signup-form" class="auth-form">
                <input type="text" id="signup-name" placeholder="T√™n hi·ªÉn th·ªã" required>
                <input type="email" id="signup-email" placeholder="Email" required>
                <input type="password" id="signup-password" placeholder="M·∫≠t kh·∫©u (t·ªëi thi·ªÉu 6 k√Ω t·ª±)" required>
                <button id="signup-btn" class="btn-primary">ƒêƒÉng K√Ω</button>
                <button id="google-signup-btn" class="btn-google">ƒêƒÉng k√Ω v·ªõi Google</button>
                <p id="signup-error" class="error-message"></p>
            </div>
        </div>
    </div>

    <!-- Main Game Container -->
    <div id="game-container" class="hidden">
        <!-- Top UI Bar -->
        <div class="top-ui-bar">
            <div class="streak-counter">
                <span class="streak-icon">üî•</span>
                <span id="streak-days" class="streak-number">0</span>
                <span class="streak-label">Ng√†y</span>
            </div>
            <div class="user-stats">
                <div class="stat-item">
                    <span class="stat-label">ƒêi·ªÉm:</span>
                    <span id="total-points" class="stat-value">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">C·∫•p:</span>
                    <span id="user-level" class="stat-value">1</span>
                </div>
            </div>
            <div class="user-menu">
                <button id="login-prompt-btn" class="btn-icon" title="ƒêƒÉng nh·∫≠p ƒë·ªÉ l∆∞u ti·∫øn ƒë·ªô">üîê</button>
                <button id="profile-btn" class="btn-icon hidden" title="H·ªì s∆°">üë§</button>
                <button id="logout-btn" class="btn-icon hidden" title="ƒêƒÉng xu·∫•t">üö™</button>
            </div>
        </div>

        <!-- 3D Canvas -->
        <canvas id="game-canvas"></canvas>

        <!-- Side Panel - Mini Games -->
        <div id="side-panel" class="side-panel">
            <h3>Mini Games</h3>
            <div class="game-buttons">
                <button class="game-btn" data-game="meditation-32">
                    <span class="game-icon">üßò</span>
                    <span>Thi·ªÅn 32 Th·ªÉ Tr∆∞·ª£c</span>
                </button>
                <button class="game-btn" data-game="memory">
                    <span class="game-icon">üß©</span>
                    <span>Memory Game</span>
                </button>
                <button class="game-btn" data-game="breathing">
                    <span class="game-icon">üí®</span>
                    <span>Th·ªü S√¢u</span>
                </button>
                <button class="game-btn" data-game="body-scan">
                    <span class="game-icon">üëÅÔ∏è</span>
                    <span>Qu√©t C∆° Th·ªÉ</span>
                </button>
                <button class="game-btn" data-game="whack-mole">
                    <span class="game-icon">‚ö°</span>
                    <span>ƒê√°nh Bay D·ª•c V·ªçng</span>
                </button>
                <button class="game-btn" data-game="quiz">
                    <span class="game-icon">üìö</span>
                    <span>Quiz Ch√≠nh Ph√°p</span>
                </button>
                <button class="game-btn" data-game="typing">
                    <span class="game-icon">‚å®Ô∏è</span>
                    <span>G√µ Ch·ªØ Thanh T·ªãnh</span>
                </button>
                <button class="game-btn" data-game="color-match">
                    <span class="game-icon">üé®</span>
                    <span>Gh√©p M√†u Thanh T·ªãnh</span>
                </button>
            </div>
            <div class="therapy-tools-section">
                <h4>üõ†Ô∏è C√¥ng C·ª• Tr·ªã Li·ªáu</h4>
                <div class="therapy-buttons">
                    <button class="therapy-btn" data-therapy="urge-surfing">
                        <span class="therapy-icon">üåä</span>
                        <span>Urge Surfing</span>
                    </button>
                    <button class="therapy-btn" data-therapy="grounding">
                        <span class="therapy-icon">üåç</span>
                        <span>5-4-3-2-1 Grounding</span>
                    </button>
                    <button class="therapy-btn" data-therapy="relapse-prevention">
                        <span class="therapy-icon">üõ°Ô∏è</span>
                        <span>Ph√≤ng Ng·ª´a T√°i Nghi·ªán</span>
                    </button>
                    <button class="therapy-btn" data-therapy="emergency">
                        <span class="therapy-icon">üö®</span>
                        <span>Giao Th·ª©c Kh·∫©n C·∫•p</span>
                    </button>
                </div>
            </div>
            <div class="leaderboard-section">
                <h4>üèÜ B·∫£ng X·∫øp H·∫°ng C√¥ng Khai</h4>
                <div id="public-leaderboard"></div>
            </div>
        </div>

        <!-- Bottom UI -->
        <div class="bottom-ui">
            <button id="emergency-help-btn" class="emergency-btn">
                üßò Tr√≤ Chuy·ªán V·ªõi Th·∫ßy Th√≠ch Nh·∫•t H·∫°nh
            </button>
            <button id="chat-toggle-btn" class="chat-toggle-btn">
                üí¨ Chat
            </button>
        </div>

        <!-- Chat Panel -->
        <div id="chat-panel" class="chat-panel hidden">
            <div class="chat-header">
                <h3>C·ªông ƒê·ªìng H·ªó Tr·ª£</h3>
                <button id="chat-close-btn" class="close-btn">&times;</button>
            </div>
            <div id="chat-messages" class="chat-messages"></div>
            <div class="chat-input-container">
                <input type="text" id="chat-input" placeholder="Nh·∫Øn tin khuy·∫øn kh√≠ch m·ªçi ng∆∞·ªùi..." maxlength="500">
                <button id="chat-send-btn" class="btn-send">G·ª≠i</button>
            </div>
        </div>

        <!-- AI Counselor Modal -->
        <div id="ai-counselor-modal" class="modal hidden">
            <div class="modal-content ai-modal">
                <span class="close-modal">&times;</span>
                <h2>üßò Th·∫ßy Th√≠ch Nh·∫•t H·∫°nh - T∆∞ V·∫•n Kh·∫©n C·∫•p</h2>
                <div id="ai-chat-container" class="ai-chat-container">
                    <div class="ai-message">
                        <p>Xin ch√†o con! Th·∫ßy Th√≠ch Nh·∫•t H·∫°nh ·ªü ƒë√¢y ƒë·ªÉ gi√∫p con v∆∞·ª£t qua c∆°n cu·ªìng d·ª•c n√†y. H√£y chia s·∫ª v·ªõi th·∫ßy con ƒëang c·∫£m th·∫•y th·∫ø n√†o?</p>
                    </div>
                </div>
                <div class="ai-input-container">
                    <textarea id="ai-input" placeholder="Vi·∫øt tin nh·∫Øn c·ªßa b·∫°n..." rows="3"></textarea>
                    <button id="ai-send-btn" class="btn-primary">G·ª≠i</button>
                </div>
                <div class="ai-suggestions">
                    <p>Ho·∫∑c th·ª≠ m·ªôt trong nh·ªØng mini-games n√†y ƒë·ªÉ ph√¢n t√¢m:</p>
                    <div class="suggestion-buttons">
                        <button class="suggestion-btn" data-game="breathing">Th·ªü S√¢u</button>
                        <button class="suggestion-btn" data-game="meditation-32">Thi·ªÅn 32 Th·ªÉ Tr∆∞·ª£c</button>
                        <button class="suggestion-btn" data-game="body-scan">Qu√©t C∆° Th·ªÉ</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Game Modal Container -->
        <div id="game-modal" class="game-modal hidden">
            <div class="game-modal-content">
                <button id="close-game-btn" class="close-game-btn">&times;</button>
                <div id="game-content"></div>
            </div>
        </div>

        <!-- Achievement Notification -->
        <div id="achievement-notification" class="achievement-notification hidden">
            <div class="achievement-content">
                <div class="achievement-icon">üèÜ</div>
                <div class="achievement-text">
                    <h3>TH√ÄNH T·ª∞U M·ªöI!</h3>
                    <p id="achievement-name"></p>
                </div>
            </div>
        </div>

        <!-- Daily Check-in Modal -->
        <div id="checkin-modal" class="modal">
            <div class="modal-content checkin-modal">
                <h2>üéâ Check-in H√¥m Nay!</h2>
                <div id="checkin-message" class="checkin-message"></div>
                <div class="checkin-stats">
                    <div class="checkin-stat">
                        <span class="checkin-label">Streak hi·ªán t·∫°i:</span>
                        <span id="checkin-streak" class="checkin-value">0</span>
                    </div>
                    <div class="checkin-stat">
                        <span class="checkin-label">ƒêi·ªÉm nh·∫≠n ƒë∆∞·ª£c:</span>
                        <span id="checkin-points" class="checkin-value">+100</span>
                    </div>
                </div>
                <button id="confirm-checkin-btn" class="btn-primary btn-large">X√°c Nh·∫≠n Check-in</button>
            </div>
        </div>

        <!-- Profile Modal -->
        <div id="profile-modal" class="modal hidden">
            <div class="modal-content profile-modal">
                <span class="close-modal">&times;</span>
                <h2>H·ªì S∆° C·ªßa B·∫°n</h2>
                <div class="profile-info">
                    <div class="profile-avatar">
                        <div class="avatar-3d" id="profile-avatar-3d"></div>
                    </div>
                    <h3 id="profile-name"></h3>
                    <div class="profile-stats-grid">
                        <div class="profile-stat">
                            <span class="stat-icon">üî•</span>
                            <span class="stat-label">Streak hi·ªán t·∫°i</span>
                            <span id="profile-streak" class="stat-number">0</span>
                        </div>
                        <div class="profile-stat">
                            <span class="stat-icon">‚≠ê</span>
                            <span class="stat-label">Streak d√†i nh·∫•t</span>
                            <span id="profile-longest-streak" class="stat-number">0</span>
                        </div>
                        <div class="profile-stat">
                            <span class="stat-icon">üíé</span>
                            <span class="stat-label">T·ªïng ƒëi·ªÉm</span>
                            <span id="profile-total-points" class="stat-number">0</span>
                        </div>
                        <div class="profile-stat">
                            <span class="stat-icon">üìä</span>
                            <span class="stat-label">C·∫•p ƒë·ªô</span>
                            <span id="profile-level" class="stat-number">1</span>
                        </div>
                    </div>
                </div>
                <div class="profile-achievements">
                    <h3>Th√†nh T·ª±u</h3>
                    <div id="achievements-list" class="achievements-grid"></div>
                </div>
                <div class="profile-badges">
                    <h3>Huy Hi·ªáu</h3>
                    <div id="badges-list" class="badges-grid"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script type="module" src="js/firebase-config.js"></script>
    <script type="module" src="js/auth.js"></script>
    <script type="module" src="js/game-engine.js"></script>
    <script type="module" src="js/gamification.js"></script>
    <script type="module" src="js/ai-counselor.js"></script>
    <script type="module" src="js/chat-system.js"></script>
    <script type="module" src="js/mini-games/meditation-game.js"></script>
    <script type="module" src="js/mini-games/memory-game.js"></script>
    <script type="module" src="js/mini-games/breathing-game.js"></script>
    <script type="module" src="js/mini-games/body-scan-game.js"></script>
    <script type="module" src="js/mini-games/whack-mole-game.js"></script>
    <script type="module" src="js/mini-games/quiz-game.js"></script>
    <script type="module" src="js/main.js"></script>
    <script type="module" src="js/encouragement-system.js"></script>
    <script type="module" src="js/public-leaderboard.js"></script>
    <script type="module" src="js/therapy-tools.js"></script>
    <script type="module" src="js/relapse-prevention.js"></script>
    <script type="module" src="js/daily-motivation.js"></script>
    <script type="module" src="js/honor-system.js"></script>
</body>
</html>

